# Первоначальная настройка облака

## Создание инфраструктуры

Для работы с консольной утилитой `yc` нам нужно создать хотябы одно облако и в нем хотя бы одну директорию. На текущем этапе мы можем это сделать только вручную.

После создания директории укажите ID облака и директории в файле `hacks/setup-env-yandex.sh`:

- `cloud_id` - ID облака;
- `folder_id` - ID директории;

После этих действий перезапустите dev контейнер.

## Перенос инфраструктуры в облако

Нам нужно применить конфигурацию из директории `infrastructure/clouds`.

Измените параметры перед применением:

- файл `locals.tf`, перепенная `clouds` - указать список облаков, которые мы будем создавать.
- файл `providers.tf`, переменная `token` - указать токен для доступа к для Яндекс облаку. Получить токен можно командой `yc iam create-token`.
   ```hcl
   provider "yandex" {
     token = "XXX"
   }
   ```

**Note**: Не сохраняйте токен в репозитории. Это - чувствительная информация, используя ее кто-то другой сможет получить доступ к вашему облаку.

TODO: описать импорт облако в IaC

## Создание ресурсов для Terraform/Atlantis

Нам нужно применить конфигурацию из директории `infrastructure/terraform`. В ней описаны все ресурсы, необходимые для хранение стейта терраформа и облаке service account, с помощью которого Atlantis будет получать доступ к этому стейру.

Перед применением нам нужно поменять:

- файл `locals.tf`, переменная `cloud_id`, указав id того облака в Яндексе, с которым будем работать;
- файл `providers.tf`, переменная `token` - указать токен для доступа к для Яндекс облаку. Получить токен можно командой `yc iam create-token`.

После создания инфраструктуры, замените в файле `hacks/setup-env-yandex.sh` переменные:

- `folder_id` - ID директории с terraform;
- `terraform_state_keys_secret_id` - ID секрета.
